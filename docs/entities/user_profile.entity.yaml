# UserProfile Entity Definition
entity: UserProfile
description: Extended profile information for users (integrates with Supabase Auth)
table: user_profiles

fields:
  - name: id
    type: UUID
    primary_key: true
    required: true
    description: Unique identifier for the profile
    
  - name: userId
    type: UUID
    foreign_key: auth.users.id
    unique: true
    required: true
    description: ID of the Supabase Auth user this profile belongs to
    
  # Core user information (moved from users table)
  - name: firstName
    type: String
    max_length: 50
    min_length: 2
    required: true
    description: User's first name
    
  - name: lastName
    type: String
    max_length: 50
    min_length: 2
    required: true
    description: User's last name
    
  - name: dateOfBirth
    type: Date
    description: User's date of birth
    
  - name: address
    type: String
    max_length: 200
    description: User's street address
    
  - name: city
    type: String
    max_length: 100
    description: User's city
    
  - name: postalCode
    type: String
    max_length: 20
    description: User's postal code
    
  - name: country
    type: String
    max_length: 100
    description: User's country
    
  - name: balance
    type: Decimal
    precision: 10
    scale: 2
    default: 0.00
    minimum: 0
    description: User's account balance
    
  - name: role
    type: Enum
    values: [buyer, seller, admin]
    default: buyer
    description: User's role in the system
    
  # Profile-specific fields
  - name: displayName
    type: String
    max_length: 50
    unique: true
    required: true
    description: User's public display name
    
  - name: avatarUrl
    type: String
    max_length: 255
    format: url
    description: URL to user's avatar image
    
  - name: bio
    type: Text
    max_length: 1000
    description: User's biography or description
    
  - name: location
    type: String
    max_length: 100
    description: User's general location
    
  - name: website
    type: String
    max_length: 255
    format: url
    description: User's website URL
    
  - name: socialMediaLinks
    type: JSON
    default: {}
    description: User's social media links
    
  # Trading-related fields
  - name: tradingReputation
    type: Integer
    default: 0
    minimum: 0
    description: User's trading reputation score
    
  - name: totalTrades
    type: Integer
    default: 0
    minimum: 0
    description: Total number of trades completed
    
  - name: successfulTrades
    type: Integer
    default: 0
    minimum: 0
    description: Number of successful trades
    
  # Settings fields
  - name: privacySettings
    type: JSON
    default: '{"profile_public": true, "collection_public": false, "trade_history_public": false}'
    description: User's privacy preferences
    
  - name: notificationPreferences
    type: JSON
    default: '{"email_notifications": true, "push_notifications": true, "trade_updates": true}'
    description: User's notification preferences
    
  - name: createdAt
    type: DateTime
    auto_generate: true
    description: When the profile was created
    
  - name: updatedAt
    type: DateTime
    auto_update: true
    description: When the profile was last updated

relationships:
  - name: user
    type: belongs_to
    target: User
    foreign_key: user_id
    references: auth.users.id
    description: The Supabase Auth user this profile belongs to

indexes:
  - fields: [user_id]
    unique: true
  - fields: [display_name]
    unique: true
  - fields: [role]
  - fields: [trading_reputation]
  - fields: [created_at]

business_rules:
  - name: one_profile_per_user
    description: Each Supabase Auth user can have only one profile
    
  - name: unique_display_name
    description: Display names must be unique across all users
    
  - name: positive_balance
    description: User balance cannot be negative
    
  - name: reputation_calculation
    description: Trading reputation is calculated based on successful trades
    
  - name: supabase_integration
    description: Profile must reference valid Supabase Auth user
